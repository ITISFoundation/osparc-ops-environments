[SERVICE]
    Flush        1
    Daemon       off
    Log_Level    info
    HTTP_Server  On
    HTTP_Listen  0.0.0.0
    HTTP_Port    2020

# Receive GELF messages from Docker containers
[INPUT]
    Name     udp
    Listen   0.0.0.0
    Port     12201
    Format   json
    Chunk_Size 8192

# Copy mandatory `short_message`, which is the only thing docker sends, to the `message` field as well to avoid confusion
[FILTER]
    Name    modify
    Match   *
    Copy    short_message message

# Output to Loki with Docker host hostname and container metadata
[OUTPUT]
    Name     loki
    Match    *
    Host     ${LOKI_HOST}
    Port     3100
    Labels   job=docker
    Label_keys $host,$container_name
    Line_format json

# Output to Graylog (GELF format - direct passthrough)
[OUTPUT]
    Name     gelf
    Match    *
    Host     ${GRAYLOG_HOST}
    Port     ${GRAYLOG_PORT}
    Mode     udp
    Gelf_Host_Key          host
    Gelf_Short_Message_Key short_message
